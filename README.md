# Bilibili视频下载器

一个功能强大的B站视频下载工具，支持批量下载、多种格式转换、断点续传等功能。

## 功能特性

- ✅ 图形化界面，操作简单
- ✅ 支持批量下载多个视频
- ✅ 支持下载合集和多分集视频
- ✅ 扫码登录B站账号
- ✅ 支持多种视频格式（MP4、AVI、FLV）
- ✅ 支持多种音频格式（MP3、AAC、FLAC）
- ✅ 可选择视频清晰度（1080P、720P、480P、360P）
- ✅ 支持断点续传
- ✅ 最多同时下载5个任务
- ✅ 实时显示下载进度、速度、剩余时间
- ✅ 自动下载视频封面
- ✅ 下载进度表格支持停止和重新下载
- ✅ 同名文件自动跳过下载
- ✅ 批量重命名功能（提取书名号/批量替换文本）
- ✅ 视频裁剪工具
- ✅ 格式转换工具（视频转MP3）
- ✅ 自定义文件名和保存路径
- ✅ 下载进度表格列宽可手动调整
- ✅ 完善的错误处理和日志记录

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用说明

### 1. 启动程序

```bash
python main.py
```

### 2. 登录B站账号（可选）

点击右上角的"登录"按钮，使用B站手机APP扫描二维码登录。登录后可以下载需要登录权限的视频。

### 3. 下载视频

1. 在"视频链接"输入框中输入B站视频链接（支持多个链接，每行一个）
2. 点击"获取信息"按钮查看视频信息
3. 在"下载选项"中选择：
   - 下载类型：视频或音频
   - 清晰度：1080P、720P、480P、360P
   - 格式：根据下载类型选择对应的格式
   - 保存路径：默认为用户下载目录下的Bilibili文件夹
   - 可选：输入自定义文件名
4. 点击"开始下载"按钮

**多分集视频下载**：
- 程序会自动识别包含多个分集的视频
- 自动为每个分集创建下载任务
- 文件名格式：`原标题 - 分集名称`

**合集视频下载**：
- 支持合集链接（collection、series、medialist、list等）
- 自动识别合集并下载所有视频
- 支持opus动态合集

**下载进度操作**：
- 停止下载：只对"下载中"状态的任务生效，点击"停止"按钮即可
- 重新下载：只对"失败"状态的任务生效，点击"重新下载"按钮即可
- 重新下载时会覆盖已存在的文件

**同名文件处理**：
- 首次下载时，如果文件已存在则自动跳过
- 重新下载时，会覆盖已存在的文件

### 4. 查看下载进度

在"下载进度"表格中可以实时查看所有下载任务的状态、进度、速度等信息。
- 表格列宽可以手动拖拽调整
- 支持对每个下载任务进行操作（停止/重新下载）

### 5. 批量重命名

切换到"批量重命名"标签页：

**提取书名号内容**：
- 自动提取《》或【】中的内容作为新文件名
- 优先级：书名号《》 > 【】
- 无书名号的文件自动跳过

**批量替换文本**：
- 查找输入框中的文本并替换为新文本
- 支持大小写敏感选项
- 只替换匹配的文本部分
- 未匹配的文件自动跳过

**使用步骤**：
1. 选择包含视频/音频文件的文件夹
2. 选择重命名模式（提取书名号或批量替换）
3. 如果选择批量替换，输入查找文本和替换文本
4. 点击"扫描文件"查看预览
5. 可以单独跳过某些文件
6. 点击"执行重命名"完成操作

### 6. 视频裁剪

切换到"裁剪工具"标签页：

1. 点击"浏览"按钮选择要裁剪的视频或音频文件
2. 查看文件信息（文件名、大小）
3. 点击"打开裁剪工具"开始裁剪
4. 在裁剪对话框中设置开始时间和结束时间
5. 点击"开始裁剪"生成新文件

### 7. 格式转换

切换到"转换工具"标签页：

1. 点击"浏览"按钮选择要转换的视频文件
2. 查看文件信息（文件名、大小）
3. 点击"开始转换"按钮
4. 自动将视频转换为MP3格式
5. 转换完成后显示保存路径

### 8. 修改设置

点击右上角的"设置"按钮，可以修改以下设置：
- 默认保存路径
- 默认清晰度
- 默认视频格式
- 默认音频格式
- 最大同时下载数
- 是否默认下载封面
- 是否自动断点续传

## 项目结构

```
BilibiliDownload/
├── main.py                 # 程序入口
├── main_window.py          # 主窗口
├── login_dialog.py         # 登录对话框
├── settings_dialog.py      # 设置对话框
├── convert_dialog.py       # 格式转换对话框
├── trim_dialog.py          # 裁剪对话框
├── bilibili_api.py         # B站API交互模块
├── download_manager.py      # 下载管理模块
├── converter.py            # 格式转换模块
├── settings_manager.py     # 设置管理模块
├── logger.py               # 日志模块
├── config.py               # 配置文件
├── requirements.txt        # 依赖列表
├── data/                   # 数据目录
├── logs/                   # 日志目录
└── config/                 # 配置目录
    └── settings.json
```

## 注意事项

1. 需要安装FFmpeg才能进行音频提取和格式转换
2. 下载速度取决于网络环境和B站服务器限制
3. 请遵守B站的使用条款，仅用于个人学习和研究
4. 下载的视频请勿用于商业用途

## 系统要求

- Python 3.7+
- Windows 10/11
- FFmpeg（用于音频提取和格式转换）

## 常见问题

### Q: 如何安装FFmpeg？

A: 下载FFmpeg并添加到系统环境变量中，或者使用conda安装：
```bash
conda install ffmpeg
```

### Q: 下载失败怎么办？

A: 检查网络连接，确保视频链接正确，尝试登录B站账号后重新下载。

### Q: 如何批量下载？

A: 在视频链接输入框中输入多个链接，每行一个，然后点击"开始下载"。

### Q: 支持下载合集吗？

A: 支持，输入合集链接即可自动识别并下载合集中的所有视频。

### Q: 如何停止正在下载的任务？

A: 在下载进度表格中，点击对应任务"操作"列中的"停止"按钮。

### Q: 如何重新下载失败的任务？

A: 在下载进度表格中，点击对应任务"操作"列中的"重新下载"按钮。

### Q: 批量重命名如何使用？

A: 
1. 选择文件夹并扫描文件
2. 选择"提取书名号"或"批量替换文本"模式
3. 如果选择批量替换，输入查找文本和替换文本
4. 查看预览列表
5. 点击"执行重命名"完成操作

## 开发者

本项目使用Python + PyQt5开发。

## 许可证

本项目仅供学习和研究使用。
